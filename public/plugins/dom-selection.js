var f=document;
"function"===typeof f.getSelection&&($.selection=function(a,b){var c,e,h,d,g,k,l,m;if(g=f.getSelection())if(null==a){if(d=g&&g.rangeCount&&g.getRangeAt(0))return{start:{container:d.startContainer,offset:d.startOffset},end:{container:d.endContainer,offset:d.endOffset},a:g}}else{if(a.pageX){k=a.pageX;l=a.pageY;null==b&&(b=a);e=b.pageX;h=b.pageY;try{document.caretPositionFromPoint?(a=document.caretPositionFromPoint(k,l),b=document.caretPositionFromPoint(e,h),d=document.createRange(),d.setStart(a.offsetNode,a.offset),
d.setEnd(b.offsetNode,b.offset)):document.caretRangeFromPoint&&(k=a.clientX,l=a.clientY,e=b.clientX,h=b.clientY,a=document.caretRangeFromPoint(k,l),b=document.caretRangeFromPoint(e,h),d=document.createRange(),d.setStart(a.startContainer,a.startOffset),d.setEnd(b.startContainer,b.startOffset)),d?(g.removeAllRanges(),g.addRange(d)):document.body.createTextRange&&(d=document.body.createTextRange(),d.moveToPoint(k,l),c=d.duplicate(),c.moveToPoint(e,h),d.setEndPoint("EndToEnd",c),d.select(),d=null!=(m=
f.getSelection())?m.getRangeAt(0):void 0)}catch(n){}}else{a.start&&(b=a.end,a=a.start);try{b||(b=a),d=f.createRange(),d.setStart(a.container,a.offset),d.setEnd(b.container,b.offset),g.removeAllRanges(),g.addRange(d)}catch(p){}}return d}},$.selection.equal=function(a,b){return a.start.container===b.start.container&&a.start.offset===b.start.offset&&a.end.container===b.end.container&&a.end.offset===b.end.offset},$.selection.clear=function(){var a;try{null!=(a=f.getSelection())&&a.removeAllRanges()}catch(b){}},
$.selection["delete"]=function(){var a,b;null!=(a=f.getSelection())&&null!=(b=a.getRangeAt(0))&&b.deleteContents()},$.selection.isCollapsed=function(){var a;return null!=(a=f.getSelection())?a.isCollapsed:void 0},$.selection.coords=function(a){var b,c,e;if(null==a||a.a){a=a&&a.a||f.getSelection();c=a.getRangeAt(0);if(!a.isCollapsed)return c.getBoundingClientRect();c=c.cloneRange()}else a.container?(c=f.createRange(),c.setStart(a.container,a.offset)):c=a.cloneRange();if(3===(a=c.startContainer).nodeType)for(b=
c.startOffset;;){if((e=c.getBoundingClientRect()).height)return e;if(0>--b)break;c.setStart(a,b)}else if(b=null!=(e=a.childNodes)?e[c.startOffset]:void 0)if(c.selectNode(b),(e=c.getBoundingClientRect()).height)return e;for(;;){c.selectNode(a);if((e=c.getBoundingClientRect()).height)return e;for(b=a;b=b.nextSibling;)if(c.selectNode(b),(e=c.getBoundingClientRect()).height)return e;for(b=a;b=b.previousSibling;)if(c.selectNode(b),(e=c.getBoundingClientRect()).height)return e;if(!(a=a.parentNode))break}return 0},
$.fn.extend({selectNode:function(){var a,b;if(b=f.getSelection())return b.removeAllRanges(),a=f.createRange(),a.selectNode(this[0]),b.addRange(a),this}}));